# ╭──────────╮
# │ Defaults │
# ╰──────────╯
- defaults:
    link:
      create: True
      relink: True
    shell:
      quiet: True
      stdout: True

# ╭─────────────────────────────────╮
# │ Create some default directories │
# ╰─────────────────────────────────╯
- create:
  - ~/Projects/
  - ~/.config/bitwarden-cli/
  - /usr/local/share/aria2/
  - /usr/local/share/zsh/functions/
  - /usr/local/share/zsh/completions/
  - ~/.config/yazi/
- link:
      # Install system-wide user-agent
    /usr/local/share/user-agent: ./user-agent

# ╭─────────────────────────────────╮
# │ Install system tools using mise │
# ╰─────────────────────────────────╯
- mise: {}

# ╭──────────────────────────╮
# │ Generate various configs │
# ╰──────────────────────────╯
- jsonnet:
    # generate git config
    "~/.config/git/":
      source: conf/git/generate.jsonnet
    # generate ssh config
    "~/.ssh/":
      source: dotssh/config.jsonnet
    # generate ripgrep config
    "~/.config/ripgrep/":
      source: conf/ripgrep/config.jsonnet

# ╭──────────────────────╮
# │ Install aria2 config │
# ╰──────────────────────╯
- shell:
  - echo "$(./conf/aria2/bin/generate-rpc-secret)" > /usr/local/share/aria2/secret
- jsonnet:
    "~/.config/aria2/":
      source: conf/aria2/aria2.jsonnet
      vars_from_file:
        ARIA2_SECRET: /usr/local/share/aria2/secret
        ARIA2_USER_AGENT: /usr/local/share/user-agent

# ╭─────────────────────────╮
# │ Clone various git repos │
# ╰─────────────────────────╯
- git:
    # ╭──────────────────╮
    # │ @microsoft/vcpkg │
    # ╰──────────────────╯
    /usr/local/share/vcpkg/:
      url: "https://github.com/microsoft/vcpkg.git"
      description: "@microsoft/vcpkg from GitHub"
      recursive: true
    # ╭───────────────╮
    # │ @s0cks/cheats │
    # ╰───────────────╯
    /usr/local/share/cheats/s0cks__cheats/:
      url: "https://github.com/s0cks/cheats.git"
      description: "@s0cks/cheats from GitHub"
      recursive: true
    # ╭─────────────────╮
    # │ @s0cks/dot-nvim │
    # ╰─────────────────╯
    ~/.config/nvim/:
      url: "https://github.com/s0cks/dot-nvim.git"
      description: "@s0cks/dot-nvim from GitHub"
      recursive: true
    # ╭────────────────────────╮
    # │ @s0cks/dot-hammerspoon │
    # ╰────────────────────────╯
    ~/.config/hammerspoon/:
      url: "https://github.com/s0cks/dot-hammerspoon.git"
      description: "@s0cks/dot-hammerspoon from GitHub"
      recursive: true
    # ╭────────────────────╮
    # │ @s0cks/dot-wezterm │
    # ╰────────────────────╯
    ~/.config/wezterm/:
      url: "https://github.com/s0cks/dot-wezterm.git"
      description: "@s0cks/dot-wezterm from GitHub"
      recursive: true

#                           ╭─────────────────────────╮
#                           │ Create various symlinks │
#                           ╰─────────────────────────╯
- link:
    # install various shell scripts into user-local fpath bin
    /usr/local/share/zsh/functions/:
      glob: true
      path: bin/*
    # install system-wide configs for various tools and apps
    ~/.config/:
      glob: true
      path: conf/*
      exclude: [ conf/ripgrep, conf/aria2, conf/git, conf/yazi, conf/zellij, conf/irssi ] #TODO(@s0cks): need to remove conf/irssi from this list
    # install custom local zimfw modules
    ~/.zim/modules/:
      glob: true
      path: zim-modules/*
    # install various dotfiles
    ~/:
      glob: true
      path: "dotconf/*"
      prefix: '.'

# ╭──────╮
# │ Yazi │
# ╰──────╯
- ya:
  - Rolv-Apneseth/starship   # starship prompt in Yazi windows
  - gosxrgxx/flexoki-dark
  - gosxrgxx/flexoki-light
- link:
    ~/.config/yazi/theme.toml: conf/yazi/theme.toml

# ╭───────────────────────╮
# │ GitHub CLI Extensions │
# ╰───────────────────────╯
- ghe:
  - dlvhdr/gh-dash
  - davidraviv/gh-clean-branches
  - mislav/gh-cp
  - vilmibm/gh-contribute
  - gennaro-tedesco/gh-f
  - meiji163/gh-notify
  - github/gh-skyline
  - HaywardMorihara/gh-tidy
  - korosuke613/gh-user-stars 

# ╭──────────────────╮
# │ Watchman Watches │
# ╰──────────────────╯
- watchman:
    "~/Projects":
      projects:
        path: "/"
        pattern: "**/*.txt"
        command: "zip projects.zip"
    "~/.config/hammerspoon":
      reload:
        path: "/"
        pattern: "**/*.lua"
        command: "hs -c 'hs.reload()'"

#TODO(@s0cks): properly install zellij configuration

# ╭───────────────────╮
# │ Platform Specific │
# ╰───────────────────╯
- if:
    cond: 'uname | grep -Eq "Darwin"'
    unmet:
    - shell:
      - command: echo "skipping MacOS config"
        quiet: True
        stdout: True
    met:
    - shell:
      - command: dotbot -d macos/ -c macos/install.yml
        quiet: True
        stdout: True
