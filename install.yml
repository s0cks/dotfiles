# ╭──────────╮
# │ Defaults │
# ╰──────────╯
- defaults:
    link:
      create: True
      relink: True
    shell:
      quiet: True
      stdout: True

# ╭─────────────────────────────────╮
# │ Create some default directories │
# ╰─────────────────────────────────╯
- create:
  - ~/Projects/
  - ~/.config/bitwarden-cli/
  - /usr/local/share/aria2/
  - /usr/local/share/zsh/functions/
  - /usr/local/share/zsh/completions/
  - ~/.config/yazi/
  - ~/.config/aria2tui/

# ╭─────────────────────────────────╮
# │ Install system tools using mise │
# ╰─────────────────────────────────╯
- mise: {}

- shell:
  - ./scripts/install-zim.sh

# ╭──────────────────────────╮
# │ Generate various configs │
# ╰──────────────────────────╯
#TODO(@s0cks): need to fix includes in jsonnet plugin
- jsonnet:
    include_dirs:
    - "."
    - libs/flexoki.libsonnet/
    - libs/plist.libsonnet/
    - conf/skhd/
    items:
      # generate git config
      "~/.config/git/":
        source: conf/git/generate.jsonnet
      "~/":
        source: dotconf/generate.jsonnet
        include_dirs:
        - dotconf/
      # generate ssh config
      "~/.ssh/":
        source: dotssh/config.jsonnet
      "~/.config/":
        source: conf/config.jsonnet
      # generate ripgrep config
      "~/.config/ripgrep/":
        include_dirs:
        - conf/ripgrep/
        source: conf/ripgrep/rg.jsonnet
      "~/.config/koji/":
        source: conf/koji/koji.jsonnet
        include_dirs:
        - conf/koji/
      "~/.config/navi/":
        source: conf/navi/navi.jsonnet
        include_dirs:
        - conf/navi/
      "~/.config/mise/":
        source: conf/mise/mise.jsonnet
        include_dirs:
        - conf/mise/
        vars:
          XDG_CONFIG_HOME:
            env: XDG_CONFIG_HOME
      "~/.config/yabai/":
        source: conf/yabai/yabai.jsonnet
        include_dirs:
        - conf/yabai/
        vars:
          XDG_CONFIG_HOME:
            env: XDG_CONFIG_HOME
      "~/.config/bottom/":
        source: conf/bottom/bottom.jsonnet
      "~/.config/eza/":
        source: conf/eza/eza.jsonnet
      "~/.config/cava/":
        source: conf/cava/config.jsonnet
      "~/.config/bat/":
        source: conf/bat/bat.jsonnet
      "~/.config/gh/":
        source: conf/gh/gh.jsonnet
      "~/.config/skhd/":
        source: conf/skhd/skhd.jsonnet
      "~/Library/Application\\ Support/pik/":
        include_dirs:
        - conf/pik/
        source: conf/pik/config.jsonnet
      "~/.config/aria2tui/":
        include_dirs:
        - conf/aria2tui/
        source: conf/aria2tui/aria2tui.jsonnet
        vars:
          ARIA2_SECRET:
            command: "gopass show -o tokens/aria2/rpc-token"

# ╭──────────────────────╮
# │ Install aria2 config │
# ╰──────────────────────╯
- shell:
  - echo "$(./conf/aria2/bin/generate-rpc-secret)" > /usr/local/share/aria2/secret
- jsonnet:
    "~/.config/aria2/":
      source: conf/aria2/aria2.jsonnet
      vars:
        ARIA2_SECRET:
          command: gopass show -o tokens/aria2/rpc-token

# ╭─────────────────────────╮
# │ Clone various git repos │
# ╰─────────────────────────╯
- git:
    # ╭──────────────────╮
    # │ @microsoft/vcpkg │
    # ╰──────────────────╯
    /usr/local/share/vcpkg/:
      url: "https://github.com/microsoft/vcpkg.git"
      description: "@microsoft/vcpkg from GitHub"
      recursive: true
    # ╭───────────────╮
    # │ @s0cks/cheats │
    # ╰───────────────╯
    /usr/local/share/cheats/s0cks__cheats/:
      url: "https://github.com/s0cks/cheats.git"
      description: "@s0cks/cheats from GitHub"
      recursive: true
    # ╭─────────────────╮
    # │ @s0cks/dot-nvim │
    # ╰─────────────────╯
    ~/.config/nvim/:
      url: "https://github.com/s0cks/dot-nvim.git"
      description: "@s0cks/dot-nvim from GitHub"
      recursive: true
    # ╭────────────────────────╮
    # │ @s0cks/dot-hammerspoon │
    # ╰────────────────────────╯
    ~/.config/hammerspoon/:
      url: "https://github.com/s0cks/dot-hammerspoon.git"
      description: "@s0cks/dot-hammerspoon from GitHub"
      recursive: true
    # ╭────────────────────╮
    # │ @s0cks/dot-wezterm │
    # ╰────────────────────╯
    ~/.config/wezterm/:
      url: "https://github.com/s0cks/dot-wezterm.git"
      description: "@s0cks/dot-wezterm from GitHub"
      recursive: true

# ╭────────────────────╮
# │ Install Toolchains │
# ╰────────────────────╯
- shell:
  - echo "installing toolchains...."
- create:
  - /usr/local/share/toolchains/
- jsonnet:
    include_dirs:
    - "."
    items:
      "/usr/local/share/toolchains/":
        source: toolchains/toolchains.jsonnet
        include_dirs:
        - toolchains/

#                           ╭─────────────────────────╮
#                           │ Create various symlinks │
#                           ╰─────────────────────────╯
- link:
    # install various shell scripts into user-local fpath bin
    /usr/local/share/zsh/functions/:
      glob: true
      path: bin/*
    # install system-wide configs for various tools and apps
    ~/.config/:
      glob: true
      path: conf/*
      exclude:
      - conf/ripgrep
      - conf/aria2
      - conf/git
      - conf/yazi
      - conf/zellij
      - conf/yabai
      - conf/bottom
      - conf/eza
      - conf/cava
      - conf/pik
      - conf/aria2tui
      - conf/bat
      - conf/gh
      - conf/lib/
      - conf/*.jsonnet
      - conf/*.libsonnet
      - conf/*.md
      - conf/*.json
      - conf/*.yml
      - conf/.*
      - conf/user-agent
      - conf/skhd
      - conf/koji
      - conf/mise
      - conf/navi
    # install various dotfiles
    ~/:
      glob: true
      path: dotconf/*
      prefix: "."
      exclude:
      - dotconf/lib/
      - dotconf/*.jsonnet
      - dotconf/*.libsonnet
      - dotconf/*.md
      - dotconf/*.json
      - dotconf/*.yml
      - dotconf/.*

# ╭──────╮
# │ Yazi │
# ╰──────╯
- ya:
  - yazi-rs/plugins:types
  - yazi-rs/plugins:piper
  - yazi-rs/plugins:vcs-files
  - yazi-rs/plugins:chmod
  - yazi-rs/plugins:mactag
  - yazi-rs/plugins:full-border
  - yazi-rs/plugins:git
  - Rolv-Apneseth/starship   # starship prompt in Yazi windows
  - gosxrgxx/flexoki-dark
  - gosxrgxx/flexoki-light
  - KKV9/compress
  - h-hg/yamb
  - Lil-Dank/lazygit
  - atareao/convert
  - DreamMaoMao/fg
  - AminurAlam/yazi-plugins:spot
  - AminurAlam/yazi-plugins:spot-video
  - AminurAlam/yazi-plugins:spot-audio
  - orhnk/system-clipboard
- link:
    ~/.config/yazi/:
      glob: true
      path: conf/yazi/*
      exclude:
      - .gitignore

# ╭────────────────╮
# │ eget Downloads │
# ╰────────────────╯
- eget:
    to: "/usr/local/bin"
    items:
    - dnaka91/otti
    - oleiade/motus

# ╭───────────────────────╮
# │ GitHub CLI Extensions │
# ╰───────────────────────╯
- ghe:
  - dlvhdr/gh-dash
  - davidraviv/gh-clean-branches
  - mislav/gh-cp
  - vilmibm/gh-contribute
  - gennaro-tedesco/gh-f
  - meiji163/gh-notify
  - github/gh-skyline
  - HaywardMorihara/gh-tidy
  - korosuke613/gh-user-stars 
  - yahsan2/gh-sub-issue
  - InditexTech/gh-sherpa

# ╭──────────────────╮
# │ Watchman Watches │
# ╰──────────────────╯
- watchman:
    "~/Projects":
      projects:
        path: "/"
        pattern: "**/*.txt"
        command: "zip projects.zip"
    "~/.config/yabai":
      reload_yabai:
        path: "/"
        pattern: "yabairc"
        command: "yabai --restart-service"
    "~/.config/hammerspoon":
      reload:
        path: "/"
        pattern: "**/*.lua"
        command: "hs -c 'hs.reload()'"

# ╭──────────────────────────╮
# │ Link eza theme correctly │
# ╰──────────────────────────╯
# TODO(@s0cks): clean this up later
- link:
    "~/.config/eza/theme.yml": "~/.config/eza/flexoki-dark.yml"

# ╭─────────────────────────╮
# │ Install weechat scripts │
# ╰─────────────────────────╯
- git: # clone the repository form GitHub
    # ╭────────────────────────╮
    # │ @s0cks/weechat-scripts │
    # ╰────────────────────────╯
    /usr/local/share/weechat-scripts/:
      url: "https://github.com/s0cks/weechat-scripts.git"
      description: "@s0cks/weechat-scripts from GitHub"
      recursive: true
- shell: # install the scripts using the supplied dotbot manifest (install.yml)
  - command: dotbot -d "/usr/local/share/weechat-scripts/" -c /usr/local/share/weechat-scripts/install.yml

#TODO(@s0cks): properly install zellij configuration

# ╭───────────────────╮
# │ Platform Specific │
# ╰───────────────────╯
- if:
    cond: 'uname | grep -Eq "Darwin"'
    unmet:
    - shell:
      - command: echo "skipping MacOS config"
        quiet: True
        stdout: True
    met:
    - shell:
      - command: dotbot -d . -c macos/install.yml
        quiet: True
        stdout: True
